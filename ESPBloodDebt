-- Ultimate Blood Debt ESP (–ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è)
getgenv().Toggle = true

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- –¢–æ—á–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –æ—Ä—É–∂–∏—è (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ)
local MURDERER_WEAPONS = {
    "Sawn-off",
    "RR-LightCompactPistolS",
    "K1911" 
}

local SHERIFF_WEAPONS = {
    "RR-Snubby",
    "GG-17",
    "IZVEKH-412"
}

-- –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –æ—Ä—É–∂–∏—è
local function getPlayerWeapons(player)
    local weapons = {}
    
    -- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ—Ö –º–µ—Å—Ç: –≤ —Ä—É–∫–∞—Ö, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å, –º–æ–¥–µ–ª—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    local checkLocations = {
        player.Character and player.Character:FindFirstChildOfClass("Humanoid"),
        player:FindFirstChild("Backpack"),
        player.Character
    }
    
    for _, location in ipairs(checkLocations) do
        if location then
            for _, item in ipairs(location:GetDescendants()) do
                if item:IsA("Tool") then
                    table.insert(weapons, item.Name)
                end
            end
        end
    end
    
    return weapons
end

-- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º —à–µ—Ä–∏—Ñ–æ–≤
local function getPlayerRole(player)
    local weapons = getPlayerWeapons(player)
    
    -- –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —à–µ—Ä–∏—Ñ–æ–≤ (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
    for _, weapon in ipairs(weapons) do
        for _, sheriffWeapon in ipairs(SHERIFF_WEAPONS) do
            if weapon == sheriffWeapon then
                return "sheriff"
            end
        end
    end
    
    -- –ó–∞—Ç–µ–º —É–±–∏–π—Ü
    for _, weapon in ipairs(weapons) do
        for _, murdererWeapon in ipairs(MURDERER_WEAPONS) do
            if weapon == murdererWeapon then
                return "murderer"
            end
        end
    end
    
    return "civilian"
end

-- –°–æ–∑–¥–∞–Ω–∏–µ ESP —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫–æ–π
local function updateESP(player)
    if not player.Character then return end
    
    -- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ ESP
    if player.Character:FindFirstChild("FinalESP") then
        player.Character.FinalESP:Destroy()
    end

    -- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∏
    local role = getPlayerRole(player)
    local highlight = Instance.new("Highlight")
    highlight.Name = "FinalESP"
    highlight.Parent = player.Character
    highlight.Adornee = player.Character
    highlight.OutlineTransparency = 0
    
    if role == "murderer" then
        highlight.FillColor = Color3.fromRGB(255, 60, 60)  -- –Ø—Ä–∫–æ-–∫—Ä–∞—Å–Ω—ã–π
        highlight.OutlineColor = Color3.fromRGB(150, 0, 0) -- –¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω–∞—è –æ–±–≤–æ–¥–∫–∞
    elseif role == "sheriff" then
        highlight.FillColor = Color3.fromRGB(100, 150, 255) -- –°–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π
        highlight.OutlineColor = Color3.fromRGB(0, 50, 150) -- –¢–µ–º–Ω–æ-—Å–∏–Ω—è—è –æ–±–≤–æ–¥–∫–∞
    else
        highlight.FillColor = Color3.fromRGB(60, 255, 60)  -- –Ø—Ä–∫–æ-–∑–µ–ª–µ–Ω—ã–π
        highlight.OutlineColor = Color3.fromRGB(0, 100, 0) -- –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω–∞—è –æ–±–≤–æ–¥–∫–∞
    end
    
    highlight.FillTransparency = 0.3
end

-- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª
local function ESPLoop()
    while getgenv().Toggle do
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                pcall(updateESP, player)
            end
        end
        task.wait(0.15) -- –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    end
end

-- –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
coroutine.wrap(ESPLoop)()

-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
local weaponInfo = string.format(
    "üî¥ –£–±–∏–π—Ü—ã: %s\nüîµ –®–µ—Ä–∏—Ñ—ã: %s",
    table.concat(MURDERER_WEAPONS, ", "),
    table.concat(SHERIFF_WEAPONS, ", ")
)

game.StarterGui:SetCore("SendNotification", {
    Title = "ESP –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω",
    Text = weaponInfo,
    Duration = 10,
    Button1 = "OK"
})

-- –§—É–Ω–∫—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
function stopESP()
    getgenv().Toggle = false
    for _, player in ipairs(Players:GetPlayers()) do
        if player.Character and player.Character:FindFirstChild("FinalESP") then
            player.Character.FinalESP:Destroy()
        end
    end
end
